<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Audio Player Waveform Generator</title>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js" type="text/javascript"></script>
  </head>
  <body>
    <h2>Wave auto generator and save</h2>
    <div class="dzsaudioplayer"></div>

    <div class="waveform" style="width:1170px;height: 140px">
        <canvas id="waveform_hover"></canvas>
    </div>  

    <script>
        jQuery(document).ready(function($){
            var wavesurfer = (function () {
                'use strict';

                var wavesurfer = Object.create(WaveSurfer);

                wavesurfer.init({
                    canvas        : document.querySelector('#waveform_hover'),
                    fillParent    : true,
                    markerColor   : 'rgba(0, 0, 0, 0.5)',
                    frameMargin   : 0.1,
                    maxSecPerPx   : parseFloat(location.hash.substring(1)),
                    scrollParent  : true,
                    loadPercent   : true,
                    waveColor     : '#ea8c52',
                    progressColor : '#ea8c52',
                    loadingColor  : '#ea8c52',
                    cursorColor   : 'transparent'
                });

                wavesurfer.load('./song.mp3');

                return wavesurfer;
				
				
				window.setTimeout('novaFunction()', 15000);
			
				
            }());
        }); 
           
            //jQuery("gera_png").ready(
			
			function novaFunction(){

              var oCanvas = document.getElementById("waveform_hover");
              Canvas2Image.saveAsPNG(oCanvas, true);

              ctx = oCanvas.getContext("2d"),   
              img = document.createElement("img");
              ctx.fillRect ( 0,0,400,400 );
              img.src = oCanvas.toDataURL();

              $.post("salvar.php", {imagem: img.src}); 

              document.body.appendChild ( img );

              e.preventDefault();
                
            }
            
    </script>

    <script src="src/canvas2image.js"></script>
    <script src="src/base64.js"></script>
    <script src="src/wavesurfer.js"></script>
    <script src="src/webaudio.js"></script>
    <script src="src/drawer.js"></script>
   <script>    </script>
  </body>
</html>	